# IVR System - Call Flow Diagrams

## System Architecture Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          FreeSWITCH Telephony Platform                   â”‚
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   SIP       â”‚   â”‚   Media     â”‚   â”‚   Call       â”‚   â”‚  Dialplan  â”‚ â”‚
â”‚  â”‚  Endpoints  â”‚â”€â”€â–¶â”‚  Processing â”‚â”€â”€â–¶â”‚   Routing    â”‚â”€â”€â–¶â”‚  Executor  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                   â”‚       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”˜
                                                                    â”‚
                                                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           IVR System (main.lua)                          â”‚
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                      Configuration Layer                           â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚  â”‚  â”‚ ivrconfig.json â”‚  â”‚automax_webAPI  â”‚  â”‚ extensions.json   â”‚   â”‚  â”‚
â”‚  â”‚  â”‚ (Flow & Nodes) â”‚  â”‚  Config.json   â”‚  â”‚ recording.json    â”‚   â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                   â”‚                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                          Core Layer                                â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚   Session    â”‚  â”‚   Call Flow   â”‚  â”‚   Operation           â”‚ â”‚  â”‚
â”‚  â”‚  â”‚   Manager    â”‚â”€â”€â”‚   Controller  â”‚â”€â”€â”‚   Dispatcher          â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                      â”‚                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                        Operations Layer                            â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚ Audio â”‚ â”‚ Input â”‚ â”‚ Record  â”‚ â”‚ API  â”‚ â”‚ TTS â”‚ â”‚ Transfer   â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”¬â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                        â”‚                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                        Services Layer                              â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚ HTTP Client â”‚  â”‚ Auth Service â”‚  â”‚ Incident Service        â”‚ â”‚  â”‚
â”‚  â”‚  â”‚             â”‚  â”‚              â”‚  â”‚ Attachment Service      â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                        Utilities Layer                             â”‚  â”‚
â”‚  â”‚  [Logging] [JSON] [String Utils] [File Utils] [Validators]        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         External Systems                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ REST APIs   â”‚  â”‚ Azure TTS   â”‚  â”‚ CRM/Ticket  â”‚  â”‚ SIP Trunks    â”‚ â”‚
â”‚  â”‚             â”‚  â”‚ Azure STT   â”‚  â”‚ Systems     â”‚  â”‚               â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Complete Call Flow Timeline

```
TIME  â”‚  COMPONENT          â”‚  ACTION
â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
0.0s  â”‚  FreeSWITCH         â”‚  Incoming call received on SIP trunk
      â”‚                     â”‚  Ring... Ring...
      â”‚                     â”‚
0.5s  â”‚  Dialplan           â”‚  Match dialplan rules
      â”‚                     â”‚  Execute main.lua script
      â”‚                     â”‚
1.0s  â”‚  main.lua           â”‚  Initialize package paths
      â”‚  Config             â”‚  Load ivrconfig.json (14,710 lines)
      â”‚                     â”‚  Load automax_webAPIConfig.json
      â”‚                     â”‚  Load extensions.json
      â”‚                     â”‚  Load recording configs
      â”‚                     â”‚  âœ“ All configs loaded successfully
      â”‚                     â”‚
1.5s  â”‚  Core               â”‚  core.initialize(session)
      â”‚  Session Manager    â”‚  Extract call UUID, caller ID, domain
      â”‚                     â”‚  Initialize session context
      â”‚                     â”‚  Setup variable cache
      â”‚                     â”‚  âœ“ Core system ready
      â”‚                     â”‚
2.0s  â”‚  Call Flow          â”‚  call_flow.start()
      â”‚                     â”‚  Find start node (IsStartNode: true)
      â”‚                     â”‚  Found: Node 1001 "Welcome Message"
      â”‚                     â”‚  Answer call â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      â”‚  Caller             â”‚  Call connected! âœ“
      â”‚                     â”‚
2.5s  â”‚  Node 1001          â”‚  OperationCode: 10 (Play Audio)
      â”‚  Operation          â”‚  Dispatcher routes to operations.audio
      â”‚  Audio              â”‚  Load audio file: welcome.wav
      â”‚  Caller             â”‚  ğŸ”Š "Welcome to our service..."
      â”‚                     â”‚  Audio complete
      â”‚                     â”‚  ChildNodeConfig â†’ Node 1002
      â”‚                     â”‚
5.0s  â”‚  Node 1002          â”‚  OperationCode: 30 (Audio + Input)
      â”‚  Operation          â”‚  Play languageoption.wav
      â”‚  Caller             â”‚  ğŸ”Š "Press 1 for English, 2 for Arabic"
      â”‚                     â”‚  Waiting for DTMF... (timeout: 10s)
      â”‚                     â”‚
7.0s  â”‚  User Input         â”‚  User presses "1" (DTMF detected)
      â”‚  Session Manager    â”‚  Store: LanguageSelected = "1"
      â”‚  Call Flow          â”‚  Match InputKeys in ChildNodeConfig
      â”‚                     â”‚  "1" â†’ Node 1008 (English flow)
      â”‚                     â”‚
7.5s  â”‚  Node 1008          â”‚  OperationCode: 30 (Menu)
      â”‚  Operation          â”‚  Play mainmenu_en.wav
      â”‚  Caller             â”‚  ğŸ”Š "Main menu. Press 1 for incidents..."
      â”‚                     â”‚  Waiting for input...
      â”‚                     â”‚
10.0s â”‚  User Input         â”‚  User presses "1"
      â”‚  Session Manager    â”‚  Store: MainMenuSelection = "1"
      â”‚  Call Flow          â”‚  Route to incident flow (Node 2001)
      â”‚                     â”‚
10.5s â”‚  Node 2001          â”‚  OperationCode: 111 (API Call)
      â”‚                     â”‚  APIId: 10 (Authentication)
      â”‚  API Operation      â”‚  Load API config from automax_webAPIConfig
      â”‚  HTTP Client        â”‚  POST https://ax3.automaxsw.com/api/v1/auth/login
      â”‚                     â”‚  Body: {"email":"admin@...", "password":"..."}
      â”‚  External API       â”‚  â† Response: {"success":true, "data":{"token":"..."}}
      â”‚  Session Manager    â”‚  Store: Access_token = "eyJhbGc..."
      â”‚                     â”‚  Store: success_response = "true"
      â”‚  Call Flow          â”‚  InputKeys "S" (Success) â†’ Node 2002
      â”‚                     â”‚
11.5s â”‚  Node 2002          â”‚  OperationCode: 30 (Audio + Input)
      â”‚  Caller             â”‚  ğŸ”Š "Please select incident category..."
      â”‚                     â”‚  1=Network, 2=Hardware, 3=Software
      â”‚                     â”‚
14.0s â”‚  User Input         â”‚  User presses "2"
      â”‚  Session Manager    â”‚  Store: ClassificationIdEn = "uuid-hardware"
      â”‚  Call Flow          â”‚  â†’ Node 2010
      â”‚                     â”‚
14.5s â”‚  Node 2010          â”‚  OperationCode: 40 (Record)
      â”‚  Operation          â”‚  Play: record_beep.wav
      â”‚  Caller             â”‚  ğŸ”Š "Beep!" [Recording started]
      â”‚                     â”‚  ğŸ¤ User speaks: "My computer won't start..."
      â”‚                     â”‚  [Recording in progress... 15 seconds]
      â”‚                     â”‚
29.5s â”‚  Recording Complete â”‚  User presses "#" to stop
      â”‚  Recording          â”‚  Save: /tmp/recordings/call_123_1234567890.wav
      â”‚  Session Manager    â”‚  Store: recording_file_path = "/tmp/recordings/..."
      â”‚  Call Flow          â”‚  â†’ Node 2011
      â”‚                     â”‚
30.0s â”‚  Node 2011          â”‚  OperationCode: 111 (API Call)
      â”‚                     â”‚  APIId: 12 (Create Incident)
      â”‚  API Operation      â”‚  Prepare request:
      â”‚                     â”‚  Replace {{Access_token}} â†’ "eyJhbGc..."
      â”‚                     â”‚  Replace {{ClassificationIdEn}} â†’ "uuid-hardware"
      â”‚  HTTP Client        â”‚  POST https://ax3.automaxsw.com/api/v1/incidents
      â”‚                     â”‚  Headers: Authorization: Bearer eyJhbGc...
      â”‚                     â”‚  Body: {"title":"Hardware Issue", "description":"..."}
      â”‚  External API       â”‚  â† Response: {"success":true, "data":{"id":"INC-001"}}
      â”‚  Session Manager    â”‚  Store: incident_no_response = "INC-001"
      â”‚  Call Flow          â”‚  InputKeys "S" â†’ Node 2012
      â”‚                     â”‚
31.5s â”‚  Node 2012          â”‚  OperationCode: 111 (API Call)
      â”‚                     â”‚  APIId: 23 (Upload Attachment)
      â”‚  API Operation      â”‚  Prepare multipart form-data:
      â”‚                     â”‚  Replace {incident_id} â†’ "INC-001"
      â”‚                     â”‚  File: /tmp/recordings/call_123_1234567890.wav
      â”‚  HTTP Client        â”‚  POST .../api/v1/incidents/INC-001/attachments
      â”‚                     â”‚  Content-Type: multipart/form-data
      â”‚  External API       â”‚  â† Response: {"success":true}
      â”‚  Call Flow          â”‚  InputKeys "S" â†’ Node 2013
      â”‚                     â”‚
33.0s â”‚  Node 2013          â”‚  OperationCode: 330 (TTS)
      â”‚                     â”‚  DeafultInput: "Your incident {{incident_no_response}}..."
      â”‚  TTS Operation      â”‚  Replace: {{incident_no_response}} â†’ "INC-001"
      â”‚                     â”‚  Text: "Your incident INC-001 has been created"
      â”‚  API                â”‚  Call Azure TTS API (APIId 19)
      â”‚  HTTP Client        â”‚  POST https://uksouth.stt.speech...
      â”‚  Azure TTS          â”‚  â† Response: [Audio data]
      â”‚  Caller             â”‚  ğŸ”Š "Your incident INC-001 has been created..."
      â”‚  Call Flow          â”‚  â†’ Node 2014
      â”‚                     â”‚
38.0s â”‚  Node 2014          â”‚  OperationCode: 10 (Play Audio)
      â”‚  Caller             â”‚  ğŸ”Š "Thank you for calling. Goodbye!"
      â”‚  Call Flow          â”‚  â†’ Node 9999 (Termination)
      â”‚                     â”‚
40.0s â”‚  Node 9999          â”‚  OperationCode: 200 (Terminate)
      â”‚  Termination        â”‚  Clean up resources
      â”‚                     â”‚  Log call statistics
      â”‚                     â”‚  Hangup call
      â”‚  Caller             â”‚  Call ended â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      â”‚                     â”‚
      â”‚  main.lua           â”‚  Exit successfully
      â”‚  FreeSWITCH         â”‚  Call complete. Duration: 38.0s
```

---

## Node Type Flow Patterns

### 1. Audio Playback Pattern (Operation 10)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Node 1001             â”‚
â”‚   Op: 10 (Play Audio)   â”‚
â”‚   File: welcome.wav     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â”‚ [Audio plays]
            â”‚ No user input required
            â”‚
            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Node 1002             â”‚
â”‚   (Next node)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. Menu Selection Pattern (Operation 30)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Node 1002                 â”‚
â”‚   Op: 30 (Audio + Input)    â”‚
â”‚   File: menu.wav            â”‚
â”‚   ValidKeys: "1,2,3"        â”‚
â”‚   Timeout: 10s              â”‚
â”‚   Repeat: 3 times           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ [Play audio]
           â”‚ [Wait for DTMF]
           â”‚
           â”œâ”€â”€â”€ Press "1" â”€â”€â”€â”€â”€â”€â”€â”€â–¶ Node 2001 (Option 1 flow)
           â”‚
           â”œâ”€â”€â”€ Press "2" â”€â”€â”€â”€â”€â”€â”€â”€â–¶ Node 3001 (Option 2 flow)
           â”‚
           â”œâ”€â”€â”€ Press "3" â”€â”€â”€â”€â”€â”€â”€â”€â–¶ Node 4001 (Option 3 flow)
           â”‚
           â”œâ”€â”€â”€ Invalid/Timeout â”€â”€â–¶ Node 1003 (Error handler)
           â”‚                        [Play: invalid.wav]
           â”‚                        [Repeat count++]
           â”‚                        â””â”€â”€â–¶ Back to Node 1002
           â”‚                             (if repeat < limit)
           â”‚
           â””â”€â”€â”€ Max Repeats â”€â”€â”€â”€â”€â”€â–¶ Node 9999 (Terminate)
```

### 3. Recording Pattern (Operation 40)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Node 2010                 â”‚
â”‚   Op: 40 (Record)           â”‚
â”‚   Beep: record_beep.wav     â”‚
â”‚   MaxTime: 120s             â”‚
â”‚   TagName: recording_path   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ [Play beep]
           â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ ğŸ¤ Recording â”‚
    â”‚   in         â”‚
    â”‚   progress   â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ User presses "#" or silence detected
           â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Save to file:    â”‚
    â”‚ /tmp/rec_123.wav â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ Store path in session
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Session Variables         â”‚
â”‚   recording_path =          â”‚
â”‚   "/tmp/rec_123.wav"        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Node 2011                 â”‚
â”‚   (Upload/Process)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4. API Call Pattern (Operation 111)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Node 3001                    â”‚
â”‚   Op: 111 (API Call)           â”‚
â”‚   APIId: 12                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Load API Config              â”‚
â”‚   (automax_webAPIConfig.json)  â”‚
â”‚   apiId: 12                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Prepare Request              â”‚
â”‚   â€¢ Replace {{variables}}      â”‚
â”‚   â€¢ Build headers              â”‚
â”‚   â€¢ Build body                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Execute HTTP Request         â”‚
â”‚   POST https://api.example.com â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”œâ”€â”€â”€ 200 OK â”€â”€â”€â”€â”€â”€â”
           â”‚                 â”‚
           â–¼                 â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Parse JSON  â”‚   â”‚ Error: 500   â”‚
    â”‚ Response    â”‚   â”‚ Retry logic  â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                 â”‚
           â–¼                 â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   Extract Fields             â”‚
    â”‚   â€¢ Access_token = "..."     â”‚
    â”‚   â€¢ success = true           â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   Validate Success           â”‚
    â”‚   IsSuccessValidator: true   â”‚
    â”‚   success == "true"          â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”œâ”€â”€â”€ Success â”€â”€â”€â”€â”€â”€â”€â”€â–¶ Node 3002 (InputKeys: "S")
           â”‚
           â””â”€â”€â”€ Failure â”€â”€â”€â”€â”€â”€â”€â”€â–¶ Node 3099 (InputKeys: "F")
```

### 5. Conditional Logic Pattern (Operation 120)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Node 4001                    â”‚
â”‚   Op: 120 (Logic)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Evaluate Conditions          â”‚
â”‚   Get: CustomerType            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚
           â”œâ”€â”€â”€ CustomerType == "VIP" â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ Node 4010
           â”‚                                        (VIP flow)
           â”‚
           â”œâ”€â”€â”€ CustomerType == "Premium" â”€â”€â”€â”€â”€â”€â”€â”€â–¶ Node 4020
           â”‚                                        (Premium flow)
           â”‚
           â”œâ”€â”€â”€ CustomerType == "Standard" â”€â”€â”€â”€â”€â”€â”€â–¶ Node 4030
           â”‚                                        (Standard flow)
           â”‚
           â””â”€â”€â”€ Default (InputKeys: "*") â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ Node 4040
                                                    (Default flow)
```

### 6. Transfer Pattern (Operation 100/101)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Node 5001                    â”‚
â”‚   Op: 101 (Transfer to Queue)  â”‚
â”‚   Queue: "support_queue"       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Check Queue Availability     â”‚
â”‚   Available agents: 3          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”œâ”€â”€â”€ Agents Available â”€â”€â”
           â”‚                       â”‚
           â–¼                       â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
    â”‚ Play hold   â”‚               â”‚
    â”‚ music       â”‚               â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜               â”‚
           â”‚                       â”‚
           â–¼                       â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
    â”‚ Connect to  â”‚               â”‚
    â”‚ agent       â”‚               â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜               â”‚
           â”‚                       â”‚
           â”œâ”€â”€â”€ Connected â”€â”€â”€â”€â”€â”€â”€â”€â–¶ End IVR
           â”‚                       (Agent handles call)
           â”‚
           â””â”€â”€â”€ Failed â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ Node 5002
                                   (Voicemail/Callback)
```

### 7. Text-to-Speech Pattern (Operation 330)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Node 6001                    â”‚
â”‚   Op: 330 (TTS)                â”‚
â”‚   Text: "Welcome {{Name}}"     â”‚
â”‚   APIId: 19                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Replace Variables            â”‚
â”‚   {{Name}} â†’ "John Smith"      â”‚
â”‚   Result: "Welcome John Smith" â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Call Azure TTS API           â”‚
â”‚   â€¢ Language: en-US            â”‚
â”‚   â€¢ Voice: GuyNeural           â”‚
â”‚   â€¢ Text: "Welcome John Smith" â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Receive Audio Data           â”‚
â”‚   Format: WAV/PCM              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Play Audio to Caller         â”‚
â”‚   ğŸ”Š "Welcome John Smith"      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Node 6002                    â”‚
â”‚   (Next node)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Error Handling Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Error Scenarios                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. Invalid DTMF Input:
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ User presses â”‚
   â”‚ invalid key  â”‚
   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ ChildNodeConfig: â”‚
   â”‚ InputKeys: "X"   â”‚â”€â”€â”€â”€â”€â”€â–¶ Play: invalid_input.wav
   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Repeat counter++ â”‚
   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”œâ”€â”€â”€ < RepeatLimit â”€â”€â”€â”€â–¶ Retry same node
          â”‚
          â””â”€â”€â”€ >= RepeatLimit â”€â”€â”€â–¶ Max repeat node â†’ Terminate


2. Input Timeout:
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ No input for â”‚
   â”‚ 10 seconds   â”‚
   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ ChildNodeConfig: â”‚
   â”‚ InputKeys: "T"   â”‚â”€â”€â”€â”€â”€â”€â–¶ Play: timeout_message.wav
   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Repeat counter++ â”‚
   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â””â”€â”€â”€ (Same as invalid input)


3. API Call Failure:
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ HTTP Error:  â”‚
   â”‚ 500, Timeout â”‚
   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Retry Logic      â”‚
   â”‚ (max 3 attempts) â”‚
   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”œâ”€â”€â”€ Success â”€â”€â”€â”€â”€â”€â”€â”€â–¶ Continue flow
          â”‚
          â””â”€â”€â”€ All retries â”€â”€â”€â–¶ ChildNodeConfig: InputKeys "F"
               failed              â†“
                                Play: api_error.wav
                                   â†“
                                Terminate or retry


4. Session/Call Drop:
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ session:     â”‚
   â”‚ ready() ==   â”‚
   â”‚ false        â”‚
   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Exit call flow   â”‚
   â”‚ gracefully       â”‚
   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Log call stats   â”‚
   â”‚ Clean up         â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Multi-Language Flow Example

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Language Selection Flow                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Node 1001: Welcome (Common)
     â”‚
     â”‚ Play: welcome_common.wav
     â”‚ "Thank you for calling..."
     â”‚
     â–¼
Node 1002: Language Selection
     â”‚
     â”‚ Play: language_option.wav
     â”‚ "Press 1 for English, Press 2 for Arabic"
     â”‚
     â”œâ”€â”€â”€ Press "1" â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€ Press "2" â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚                                   â”‚                             â”‚
     â–¼                                   â–¼                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  English Flow       â”‚           â”‚  Arabic Flow        â”‚      â”‚  Invalid Input      â”‚
â”‚  Node 1008          â”‚           â”‚  Node 1009          â”‚      â”‚  Node 1003          â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                                 â”‚                            â”‚
       â”‚ Set: LanguageSelected=1         â”‚ Set: LanguageSelected=2    â”‚ Repeat++
       â”‚                                 â”‚                            â”‚
       â–¼                                 â–¼                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      Back to Node 1002
â”‚ Main Menu (EN)      â”‚           â”‚ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©     â”‚      or Terminate
â”‚ Node 2001           â”‚           â”‚ Node 2101           â”‚
â”‚                     â”‚           â”‚                     â”‚
â”‚ Play:               â”‚           â”‚ Play:               â”‚
â”‚ mainmenu_en.wav     â”‚           â”‚ mainmenu_ar.wav     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                                 â”‚
       â”‚                                 â”‚
       â–¼                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ All subsequent      â”‚           â”‚ All subsequent      â”‚
â”‚ prompts in English  â”‚           â”‚ prompts in Arabic   â”‚
â”‚                     â”‚           â”‚                     â”‚
â”‚ â€¢ Audio files: *_en â”‚           â”‚ â€¢ Audio files: *_ar â”‚
â”‚ â€¢ API calls: APIId  â”‚           â”‚ â€¢ API calls: APIId  â”‚
â”‚   for EN version    â”‚           â”‚   for AR version    â”‚
â”‚ â€¢ TTS: en-US voice  â”‚           â”‚ â€¢ TTS: ar-SA voice  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Language-Specific Configuration                                        â”‚
â”‚                                                                          â”‚
â”‚  GeneralSettings â†’ LanguageList:                                        â”‚
â”‚  [                                                                       â”‚
â”‚    {                                                                     â”‚
â”‚      "LanguageCode": 1,                                                  â”‚
â”‚      "LanguageName": "Arabic",                                           â”‚
â”‚      "TTSLanguageCode": "ar-SA",                                         â”‚
â”‚      "STTLanguageCode": "ar-SA",                                         â”‚
â”‚      "TTSVoiceNameCloud": "ar-SA-ZariyahNeural"                          â”‚
â”‚    },                                                                    â”‚
â”‚    {                                                                     â”‚
â”‚      "LanguageCode": 2,                                                  â”‚
â”‚      "LanguageName": "English",                                          â”‚
â”‚      "TTSLanguageCode": "en-US",                                         â”‚
â”‚      "STTLanguageCode": "en-US",                                         â”‚
â”‚      "TTSVoiceNameCloud": "en-US-GuyNeural"                              â”‚
â”‚    }                                                                     â”‚
â”‚  ]                                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Complete Incident Creation Flow

```
START CALL
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Node 1001     â”‚  Op 10: Play welcome.wav
â”‚ Welcome       â”‚  "Thank you for calling..."
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Node 1002     â”‚  Op 30: Language selection
â”‚ Language      â”‚  Press 1=EN, 2=AR
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â”œâ”€â”€â”€ "1" (English) â”€â”€â”€â”
        â”‚                     â”‚
        â–¼                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Node 2001     â”‚      â”‚ Node 2101     â”‚
â”‚ Auth API (EN) â”‚      â”‚ Auth API (AR) â”‚
â”‚ APIId: 10     â”‚      â”‚ APIId: 10     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                      â”‚
        â”‚ POST /auth/login     â”‚
        â”‚ Store: Access_token  â”‚
        â”‚                      â”‚
        â–¼                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Node 2002     â”‚      â”‚ Node 2102     â”‚
â”‚ Main Menu(EN) â”‚      â”‚ Main Menu(AR) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                      â”‚
        â”‚ Press 1=Incident     â”‚
        â”‚                      â”‚
        â–¼                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Node 2010     â”‚      â”‚ Node 2110     â”‚
â”‚ Category (EN) â”‚      â”‚ Category (AR) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                      â”‚
        â”‚ Press 2=Hardware     â”‚
        â”‚ Store: ClassificationIdEn
        â”‚                      â”‚
        â–¼                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Node 2020     â”‚      â”‚ Node 2120     â”‚
â”‚ Location (EN) â”‚      â”‚ Location (AR) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                      â”‚
        â”‚ Press 1=Building A   â”‚
        â”‚ Store: LocationIdEn  â”‚
        â”‚                      â”‚
        â–¼                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Node 2030     â”‚      â”‚ Node 2130     â”‚
â”‚ Caller Name   â”‚      â”‚ Ø§Ø³Ù… Ø§Ù„Ù…ØªØµÙ„     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                      â”‚
        â”‚ Collect digits       â”‚
        â”‚ Or use STT           â”‚
        â”‚ Store: CallerName    â”‚
        â”‚                      â”‚
        â–¼                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Node 2040     â”‚      â”‚ Node 2140     â”‚
â”‚ Record Issue  â”‚      â”‚ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©  â”‚
â”‚ Op 40         â”‚      â”‚ Op 40         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                      â”‚
        â”‚ ğŸ¤ Record 120s       â”‚
        â”‚ Store: recording_pathâ”‚
        â”‚                      â”‚
        â–¼                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Node 2050     â”‚      â”‚ Node 2150     â”‚
â”‚ Create        â”‚      â”‚ Ø¥Ù†Ø´Ø§Ø¡ Ø¨Ù„Ø§Øº     â”‚
â”‚ Incident API  â”‚      â”‚ Incident API  â”‚
â”‚ APIId: 12(EN) â”‚      â”‚ APIId: 11(AR) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                      â”‚
        â”‚ POST /incidents      â”‚
        â”‚ Body: {              â”‚
        â”‚   title: "Hardware", â”‚
        â”‚   description: "...",â”‚
        â”‚   classification_id, â”‚
        â”‚   location_id,       â”‚
        â”‚   reporter_name,     â”‚
        â”‚   priority: 3        â”‚
        â”‚ }                    â”‚
        â”‚                      â”‚
        â”‚ Response:            â”‚
        â”‚ Store: incident_no_response = "INC-001"
        â”‚ Store: ticket_number_response = "TKT-12345"
        â”‚                      â”‚
        â–¼                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Node 2060     â”‚      â”‚ Node 2160     â”‚
â”‚ Upload Audio  â”‚      â”‚ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØª    â”‚
â”‚ APIId: 23     â”‚      â”‚ APIId: 23     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                      â”‚
        â”‚ POST /incidents/{id}/attachments
        â”‚ File: recording_path â”‚
        â”‚                      â”‚
        â–¼                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Node 2070     â”‚      â”‚ Node 2170     â”‚
â”‚ Confirm (TTS) â”‚      â”‚ ØªØ£ÙƒÙŠØ¯ (TTS)    â”‚
â”‚ Op 330        â”‚      â”‚ Op 330        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                      â”‚
        â”‚ ğŸ”Š "Your incident    â”‚
        â”‚ INC-001 with ticket  â”‚
        â”‚ number TKT-12345     â”‚
        â”‚ has been created"    â”‚
        â”‚                      â”‚
        â–¼                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Node 2080     â”‚      â”‚ Node 2180     â”‚
â”‚ Goodbye       â”‚      â”‚ ÙˆØ¯Ø§Ø¹Ø§          â”‚
â”‚ Op 10         â”‚      â”‚ Op 10         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                      â”‚
        â–¼                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Node 9999     â”‚      â”‚ Node 9999     â”‚
â”‚ Terminate     â”‚      â”‚ Terminate     â”‚
â”‚ Op 200        â”‚      â”‚ Op 200        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                      â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
              END CALL
```

---

## Session Variables Lifecycle

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Session Variable Timeline                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

CALL START
â”‚
â”œâ”€ [System Variables]
â”‚  â”œâ”€ uuid = "550e8400-e29b-41d4-a716-446655440000"
â”‚  â”œâ”€ caller_id_number = "+1234567890"
â”‚  â”œâ”€ caller_id_name = "John Smith"
â”‚  â””â”€ domain_name = "example.com"
â”‚
â”œâ”€ Node 1002: Language Selection
â”‚  â””â”€ LanguageSelected = "1"  (User pressed 1)
â”‚
â”œâ”€ Node 2001: Authentication API
â”‚  â”œâ”€ Access_token = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
â”‚  â””â”€ success_response = "true"
â”‚
â”œâ”€ Node 2010: Category Selection
â”‚  â””â”€ ClassificationIdEn = "2daccf67-ef54-408d-be25-1ec3afabc8c3"
â”‚
â”œâ”€ Node 2020: Location Selection
â”‚  â””â”€ LocationIdEn = "27fb9b0e-00bf-4c59-8c36-a8f716f7ae7e"
â”‚
â”œâ”€ Node 2030: Caller Name Input
â”‚  â””â”€ CallerNameTextEn = "John Smith"
â”‚
â”œâ”€ Node 2040: Record Issue
â”‚  â””â”€ recording_file_path = "/tmp/recordings/call_550e8400_1234567890.wav"
â”‚
â”œâ”€ Node 2050: Create Incident API
â”‚  â”œâ”€ incident_no_response = "6a8d3f12-9c4e-4b21-a567-8f9d0e1a2b3c"
â”‚  â”œâ”€ ticket_number_response = "INC-2024-001234"
â”‚  â””â”€ incident_number_response = "001234"
â”‚
â”œâ”€ Node 2060: Upload Attachment API
â”‚  â””â”€ attachment_success = "true"
â”‚
â””â”€ CALL END
   [All variables cleared]
```

---

## Data Flow: From User to External System

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Caller    â”‚
â”‚   Speaks    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ DTMF: "1", "2", "#"
       â”‚ Audio: Voice recording
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   FreeSWITCH        â”‚
â”‚   Session           â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ session:getDigits()
       â”‚ session:recordFile()
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Session Manager   â”‚
â”‚   Variable Store    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ set_variable("key", "value")
       â”‚ get_variable("key")
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   API Operation     â”‚
â”‚   operations/api    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ Replace {{variables}}
       â”‚ Build request
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   HTTP Client       â”‚
â”‚   services/http     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ HTTP Request:
       â”‚ POST /api/v1/incidents
       â”‚ {
       â”‚   "title": "Hardware Issue",
       â”‚   "classification_id": "...",
       â”‚   "location_id": "...",
       â”‚   "reporter_name": "John Smith"
       â”‚ }
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   External API      â”‚
â”‚   (CRM/Ticketing)   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ Response:
       â”‚ {
       â”‚   "success": true,
       â”‚   "data": {
       â”‚     "id": "INC-001",
       â”‚     "ticket_number": "TKT-12345"
       â”‚   }
       â”‚ }
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   API Operation     â”‚
â”‚   Parse Response    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ Extract fields:
       â”‚ â€¢ incident_no_response
       â”‚ â€¢ ticket_number_response
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Session Manager   â”‚
â”‚   Store Results     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Call Flow         â”‚
â”‚   Route Next Node   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Confirmation      â”‚
â”‚   to Caller         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**For detailed explanations, see DOCUMENTATION.md**
**For quick syntax reference, see QUICK_REFERENCE.md**
